# 가상돔(Virtual DOM)이란

## 돔 이란
- DOM(Document Object Model)이란 문서 객체 모델을 의미
    - 문서객체: html, head, body와 같은 태그들을 js가 이용할 수 있는 (메모리에 보관할 수 있는)  객체
- DOM은 HTML과 JS를 서로 이어주는 역할

<img src="./../Image/DOM.png" width="500px" height="150px" title="px(픽셀) 크기 설정" alt="DOM"></img>

```
웹 페이지를 이루는 태그들을 js가 이용할 수 있게끔 브라우저가 트리구조로 만든 객체 모델
```

<img src="./../Image/DOM%20tree.png" width="700px" height="550px" title="px(픽셀) 크기 설정" alt="DOM"></img>

## DOM을 직접 접근할 때의 문제점
- DOM에 직접 접근하려면 DOM Tree의 최상단에 있는 document DOM을 통해서 트리 밑으로 내려가면서 해당 DOM을 찾는 방식으로만 접근할 수 있고, 이러한 최상단 DOM의 접근은 브라우저의 잦은 렌더링을 유발하며, DOM의 작은 변경점조차 이러한 렌더링 과정을 반복하기 때문에 효율성이 떨어지게 된다.

## 가상돔이 필요한 이유
- 예를 들어 위의 트리구조를 우리가 작업하고 있는 페이지라고 가정하여 <li> 태그의 색상을 빨간색으로 변경한다고 했을 때 document.getElementById('li의 id')라는 DOM 접근 메서드를 이용할 것이다.
  - 이 방법의 2가지 문제점
      1. 메모리 누수와 속도
          - 개발자가 <li> 태그를 변수에 저장하지 않고 매번 <li>와 관련된 접근 메서드를 사용한다면 수많은 document 객체들을 전부 확인하며 찾는 메모리 누수 현상이 발생
          - 또한, <li>의 변화가 일어난다면 리플로우와 리페인트가 매번 반복되는 현상이 발생하여 시간이 소요

       1. 길어지는 코드의 양

      - 객체를 찾기 위해 작성되는 코드의 양이 길어질 수 있다.
      - 유니크한 id의 네이밍을 위해 고민해야 한다.
      - 해당 태그를 접근하는 메서드의 코드는 짧지 않다. (document.getElementById('li의 id'))

## 가상돔(Virtual DOM) 이란? 
- 실제 돔에 접근하여 조작하는 대신 이것을 추상화시킨 JS 객체를 이용해 사용
- 실제돔의 복사본같은 개념

<img src="./../Image/virtualDOM%20절차.png" width="700px" height="550px" title="px(픽셀) 크기 설정" alt="DOM"></img>

- 리엑트의 가상돔을 반영하는 순서
    1. 데이터가 업데이트 되면 전체 UI를 가상돔에 리렌더링 시킨다.
    2. 변화 전의 가상돔과 변화 후의 가상돔을 비교
    3. 변경된 부분만 실제 돔에 적용하여 리플로우를 한 번만 실행

## 가상 돔의 의미와 장점
- 가상 돔은 말 그대로 별도 객체로 DOM을 생성하는 것이다. DOM에서 발생하는 여러 변경점들을 별도의 공간(버퍼)에 가상 DOM을 생성해 일정 동안 모은 뒤, 렌더링의 변경 시점이 생기면 그 때 가상 DOM으로부터 변경된 점을 일괄적으로 갱신하는 방법이다. (어차피 DOM을 실제로 수정하려면 최상단 Tree에 접근해야 한다.) 브라우저의 렌더링 횟수를 줄여 성능 개선을 도모할 수 있다.

## 결론: 
- 자잘한 리플로우 변경이 여러번 실행되는 것 보다는 큰 규모의 리플로우가 한 번 일어나는 것이 더욱 효율적이며, 이것은 성능상의 차이로 나타난다. 리엑트는 이와 같은 방식을 이용하여 성능 향상을 이끌어 내는 프레임워크이다.